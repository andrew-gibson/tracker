<div id="{{m}}-{{attr}}-results">

    <script type="module">
    import  {append_edit_fk, append_edit_attr } from "d3-ui";
    (()=>{
        const data =_.chain({{dumps(results)|safe}})
                   .values()
                   .filter(x=>x.results.length >0)
                   .map(x=>{
                        console.log(x)
                        const color = x.model_info.rgba;
                        const border = x.model_info.hex;
                        return {
                          verbose : x.verbose,
                          results : _.map(_.flatten(_.map(x.results,xx=>xx[1])), xx=> ({color,border,...xx}))
                        }
                   })
                   .value()
        const remainder =  "{{ remainder }}";
        const root = d3.select("#{{m}}-{{attr}}-results")
                        .classed("pt-2 bg-secondary bg-opacity-10 ",true)

        const results_uls = root
            .call(selection=>{
                if (remainder){
                    selection
                        .append("div")
                        .classed("d-flex pt-2 bg-secondary bg-opacity-10 justify-content-between remainder",true)
                        .style("font-size","0.8em")
                        .append("span")
                            .classed("m-1 pe-2 align-self-center  text-secondary",true)
                            .html("{{attr}} :")
                        .select_parent()
                        .append("ul")
                            .classed("list-group list-group-horizontal",true)
                            .append("li")
                                .classed("list-group-item d-flex align-items-center justify-content-between p-1 me-1 bg-opacity-10 border-1 w-100 fw-bold",true)
                                .html(remainder)
                }
            })
             .selectAll("div.parsed")
             .data(data)
             .join("div")
            .classed("d-flex pt-2 bg-secondary bg-opacity-10 justify-content-between parsed",true)
            .style("font-size","0.8em")

        if (data.length) {
            results_uls.append("span")
                    .classed("m-1 pe-2 align-self-center  text-secondary",true)
                    .html(d=> d.verbose + ":")

            results_uls.append("ul")
                    .classed("list-group list-group-horizontal",true)
                    .styles({
                       "overflow-x": "scroll", 
                        "scrollbar-width":"none",
                       "max-width": "100%",
                    })
                    .selectAll("li")
                    .data(d=>d.results)
                    .join("li")
                    .classed("list-group-item d-flex align-items-center justify-content-between p-1 me-1 bg-opacity-10 border-1 w-100 fw-bold",true)
                    .style("background-color", d=>d.color)
                    .style("border-color", d=>d.border)
                    .append("span").html(d=>d.name)
                    .select_parent()
                    .each(function(d){
                        if (d.new){
                          d3.select(this).append("span").classed("badge bg-success ms-1",true).html("New");
                        }
                    })
        }

        root.selectAll("ul").last().classed("pb-2",true)

    })();
    </script>

</div>



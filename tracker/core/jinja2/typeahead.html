<div class="mb-3 row col-12"
     hx-swap-oob="true"
     id="typeaheadid_{{attr}}" >
    <div x-data="m2m_typeahead('{{attr}}',{{selected|safe}} )">

        <div class="border border-secondary p-0">

            {#  list of selected items #}
            <div x-show="!show_search">
                <select id="id_{{attr}}" 
                        name="id_{{attr}}" 
                        multiple
                        class="form-control d-none" >
                        <template x-for="sel in selected" :key="sel.id">
                            <option selected x-bind:id="'select'+attr+sel.id" x-bind:value="sel.id" x-text="sel.name"></option>
                        </template>
                </select>

                <ul style="min-height: 300px; max-height: 300px; overflow-y: scroll;"
                    id="id_{{attr}}_displayul"
                    class="list-group">
                    <li class="list-group-item bg-secondary border-bottom d-flex justify-content-between" >
                        <span>  </span>   
                        <a href="#" class="text-dark text-decoration-none"
                                x-ref="add_new_from_q"
                                @click="show_search=true; $nextTick(() =>  $refs.input_q.focus())" >+
                        </a>

                    </li>

                    <template x-for="sel in selected" :key="sel.id">
                        <li class="list-group-item border-bottom " 
                            x-transition.duration.750ms
                             x-data="{show : true}"
                             x-show="show">
                            <div class="d-flex justify-content-between">
                            <span x-text="sel.name"></span>   
                            <a href="#" class="text-dark text-decoration-none"
                                    @click="show=false ; remove_selected($el, sel);" >
                                    x
                            </a>
                            </div>
                        </li>
                    </template>
                </ul>
            </div>

            {#  list of search items  #}
            <div x-show="show_search"
                style="min-height: 300px; max-height: 300px; overflow-y: scroll" >

                <div class='d-flex justify-content-between'>
                    <button type="button" 
                            class="btn btn-secondary"
                            @click="close_search($data); $nextTick(() =>  $refs.add_new_from_q.focus())" > 
                            X</button>
                    <input class="form-control border-dark" 
                           x-ref="input_q"
                           id="typeaheadid_{{attr}}_q"
                           name="q"
                           hx-post="{{make_url('core:m2m_lookup')}}"
                           hx-trigger="keyup"
                           hx-swap="innerHTML"
                           hx-params="q, id_{{attr}}"
                           autocomplete="off"/>
                </div>
                <div id="typeahead_{{attr}}_results_add_button" class="d-grid"> </div>
                <ul id="typeahead_{{attr}}_results" class="list-group mt-1"> </ul>

            </div>
        </div>
    </div>
</div>

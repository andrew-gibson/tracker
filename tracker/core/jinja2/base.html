
<!DOCTYPE html>
<html lang="en">
<head>
    {% block title %}<title>RSS</title>{% endblock %}
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- <script src="https://unpkg.com/htmx.org"></script>       --> 
    <script src="{{ static('htmx.min.js') }}"></script>      
    <script src="https://unpkg.com/alpinejs" defer></script> 
    <script src="https://unpkg.com/htmx.org/dist/ext/ws.js" defer></script> 
    <script src="{{static('bootstrap-5.1.3-dist/js/bootstrap.bundle.min.js')}}">   </script>
    <link rel="stylesheet" href="{{ static('bootstrap-5.1.3-dist/css/bootstrap.min.css') }}">
    <style>
      {% include "site.css" %}
    </style>
</head>
<body>
  <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
    <div class="container-fluid">
      <span class="navbar-brand mb-0 h1">{{ _("PM") }}</span>
      <div>
        {% block header_menu %}<!-- insert default navigation text for every page -->{% endblock %}
      </div>
      <a href="{{ url("core:_logout")}}" class="btn link-light btn-link">{{ _("logout") }}</a>
    </div>
  </nav>
  <main class="container-fluid">
      <!--<div hx-ext="ws" ws-connect="/ws/rss/" > -->
    <div id="modal-container"></div>
    <div class="row">
        <div class="col-sm-12 col-md-3">
            {% if request.user.is_authenticated %}
             {% block sidebar %}{% endblock %}
            {%endif %}
        </div>
        <div class="col-sm-12 col-md-9">
            <div  id="content" >
                {% block content %}{% endblock %}
            </div>
        </div>
    </div>
  </main>
  <div id="ws-scripts"> </div>
  <script>
    const csrf_token =  '{{ csrf_token }}';
    const headers =   {  'X-CSRFToken' : csrf_token};
    document.body.addEventListener('htmx:configRequest', (event) => {
      event.detail.headers['X-CSRFToken'] = csrf_token;
    });
    const setClipboard = (text) => {
        const type = "text/plain";
        const blob = new Blob([text], { type });
        const data = [new ClipboardItem({ [type]: blob })];
        navigator.clipboard.write(data);
    };
    if (typeof window.htmx !== "undefined") {
        htmx.on("htmx:afterSettle", function(detail) {
            if (
                typeof window.djdt !== "undefined"
                && detail.target instanceof HTMLBodyElement
            ) {
                djdt.show_toolbar();
            }
        });
    }
    function htmlToElement(html) {
        var template = document.createElement('template');
        html = html.trim(); // Never return a text node of whitespace as the result
        template.innerHTML = html;
        return template.content.firstChild;
    }

    document.addEventListener('alpine:init', (attr,selected) => {
        Alpine.data("m2m_typeahead", (attr, selected) => ({
            attr : attr,
            selected  : selected,
            show_search  : false,
            remove_selected : function(el, data){
                this.selected = this.selected.filter(x=>x.id != data.id);
            },
            add_search_item : function(el, data) {
                this.selected = [data, ...this.selected];
            },
            close_search : function(data){
                 data.show_search = false; 
                 htmx.find(`#typeaheadid_${attr}_q`).value = '';
                 htmx.find(`#typeahead_${attr}_results_add_button`).innerHTML = ''
                 htmx.find(`#typeahead_${attr}_results`).innerHTML = ''

            }
        }))
    })
    {% block scripts %}


    {% endblock %}
  </script>
</body>
</html>

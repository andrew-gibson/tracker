<div id="projectlog{{inst.id}}">
    <ul class="list-group list-group-flush mt-0">
    </ul>

    <script type="module">
    import { append_edit_attr, ui_state ,make_delete_button} from "d3-ui";

    const log = ui_state.update_store({{dumps(inst)|safe}});
    const entries = await ui_state.refresh_model_store("project.ProjectLogEntry",log.entries);
    const height = d3.select(`#project${log.project.id} .card-body .left`).node().offsetHeight;

    d3.select(`#project${log.project.id} .card-body .right`).style("max-height", `${height}px`);

    d3.select(`#projectlog${log.id} .list-group`)
        .selectAll("li")
        .data(entries)
        .join("li")
        .classed("list-group-item",true)
        .each(function(d,i){
           append_edit_attr(d3.select(this).append("div").styles({"width":"90%","display" : "inline-block"}), 
                            d,
                            "text",new Date(d.addstamp).toLocaleDateString(),
                            {on_change : "reloadLog",display_attr : "rendered_text" });
           make_delete_button( 
               d3.select(this).append("div").style("width","10%").attr("class","d-inline-block text-end"),
               d,
               d=>d.id, 
               "reloadLog")
        })

    d3.select(`#projectlog${log.id} .list-group`)
        .insert("li","li:first-child")
        .classed("list-group-item",true)
        .call(selection=>{
          append_edit_attr
                const new_log = mobx.makeAutoObservable({log,text:"",__type__ : "project.ProjectLogEntry"})
                append_edit_attr(selection, new_log,"text", "New Log Entry",{on_change : "reloadLog"});
        })
    </script>
</div>

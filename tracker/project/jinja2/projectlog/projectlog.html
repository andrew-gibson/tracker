
<div id="projectlog{{inst.id}}">
    <ul class="list-group list-group-flush mt-0">
    </ul>

    <script type="module">
    import { append_edit_attr, ui_state } from "d3-ui";

    const log = {{dumps(inst)|safe}};
    const observable_data = mobx.makeAutoObservable(log);
    const height = d3.select(`#project${log.project.id} .card-body .left`).node().offsetHeight;
    d3.select(`#project${log.project.id} .card-body .right`).style("max-height", `${height}px`);

    d3.select(`#projectlog${log.id} .list-group`)
        .selectAll("li")
        .data(log.entries)
        .join("li")
        .classed("list-group-item",true)
        .each(function(d,i){
           const delete_hx_args =  {
                "hx-delete" : ui_state.models["project.ProjectLogEntry"].main_pk.replace("__pk__", d.id),
                "hx-on::after-request" : "window.reset_ui('reloadLog')",
                "hx-swap" : "none",
           }
           append_edit_attr(d3.select(this).append("div").styles({"width":"90%","display" : "inline-block"}), 
                            d,
                            "text",new Date(d.addstamp).toLocaleDateString(),
                            {on_change : "reloadLog",display_attr : "rendered_text" });
           d3.select(this).append("div").style("width","10%").attr("class","d-inline-block text-end")
                .append("button")    
                    .classed("btn btn-close",true)
                    .attrs(window.delete_modal.attrs)
                    .on("click", e=>{
                        window.delete_modal(delete_hx_args);
                    })
        })

    d3.select(`#projectlog${log.id} .list-group`)
        .insert("li","li:first-child")
        .classed("list-group-item",true)
        .call(selection=>{
          append_edit_attr
                const new_log = mobx.makeAutoObservable({log,text:"",__type__ : "project.ProjectLogEntry"})
                append_edit_attr(selection, new_log,"text", "New Log Entry",{on_change : "reloadLog"});
        })
    </script>
</div>

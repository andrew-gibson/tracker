
<div id="projectlog{{inst.id}}">
    <ul class="list-group list-group-flush mt-0">
    </ul>
</div>

<script type="module">

import { append_edit_attr } from "d3-ui";
const log = {{dumps(inst)|safe}};
const observable_data = mobx.makeAutoObservable(log);

const height = d3.select(`#project${log.project.id} .card-body .left`).node().offsetHeight;
d3.select(`#project${log.project.id} .card-body .right`).style("max-height", `${height}px`);

d3.select(`#projectlog${log.id} .list-group`)
    .selectAll("li")
    .data(log.entries)
    .join("li")
    .classed("list-group-item",true)
    .each(function(d,i){
        const selection = d3.select(this)
                            .append("div")
                            .classed(" d-flex justify-content-start align-items-center",true)
        append_edit_attr(selection, 
                        d,
                        "text",new Date(d.addstamp).toLocaleDateString(),
                        {on_change : "reloadLog",display_attr : "rendered_text" });
    })

d3.select(`#projectlog${log.id} .list-group`)
    .insert("li","li:first-child")
    .classed("list-group-item",true)
    .append("div")
    .classed(" d-flex justify-content-start align-items-center",true)
    .call(selection=>{
      append_edit_attr
            const new_log = mobx.makeAutoObservable({log,text:"",__type__ : "project.ProjectLogEntry"})
            append_edit_attr(selection, new_log,"text", "New Log Entry",{on_change : "reloadLog"});
    })


</script>

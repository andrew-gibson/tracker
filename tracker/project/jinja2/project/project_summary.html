
<div id="project{{project.id}}">
</div>

<script>
(()=>{
    const observable_data = mobx.makeAutoObservable(
      {{dumps(project)|safe}}
    );
    const add_title_links  = false; //{{'true' if add_title_links else 'false'}};
    const root = d3.select("#project{{project.id}}")
        .selectAll("div")
        .data([observable_data])
        .join("div")
        .classed("col-4 border pe-0" ,true)
        .call(function(selection){
            if (add_title_links){
                selection
                    .append("button")
                    .classed("btn btn-link pb-1 ps-0",true)
                    .attrs({
                        "hx-push-url":"true",
                        "hx-swap":"outerHTML",
                        "hx-get" : "{{url('core:rest', kwargs={'pk' :project.id, 'm' : 'project.Project'})}}",
                    })
                    .setup_htmx()
                    .html(d=>d.name)
                    .select_parent()
                    .append("div")
                    .classed("text-dark text-opacity-75 lh-1 mb-2",true)
                    .styles({
                        "font-size" : "0.8em",
                    })
                    .html(d=>d.text)
            } else {
                append_edit_attr(selection, observable_data, attr="name", title="Name");
                append_edit_attr(selection, observable_data, attr="text",title="Description");
            }
        })
        .call(function(selection){
            append_edit_fk(selection, observable_data,attr="streams", title="Streams");
            append_edit_fk(selection, observable_data,attr="point_of_contact", title="Contact");
            append_edit_fk(selection, observable_data,attr="tags", title="Tags");
            append_edit_fk(selection, observable_data,attr="teams", title="Teams");
        })

})()
</script>

{#
<div class="col-4 border" 
     x-data='project(
    {{dumps(project)|safe}}, 
    "{{url("core:rest", kwargs={"pk" :project.id, "m" : "project.Project"})}}",
    "{{url("core:text_ac", kwargs={"pk" :project.id,"attr" : "__replace__", "m" : "project.Project"})}}",
    )'>
    {% if add_title_links %}
        <button type="button" 
                class="btn btn-link pb-1 ps-0"    
                x-html="model.name"
                hx-push-url="true"
                hx-swap="outerHTML"
                hx-get="{{url('core:rss', kwargs={'pk' :project.id, 'm' : 'project.Project'})}}">
        </button>
        <div class="text-dark text-opacity-75 lh-1 mb-2 " 
             style="font-size: 0.8em;"
             x-html="model.text">
        </div>
    {% else %}
        {%with attr = "name", title = "Name" %}
            {% include "alpine_fragments/edit_attr.html"  %}
        {%endwith%}
        {%with attr = "text", title = "Text" %}
            {% include "alpine_fragments/edit_attr.html"  %}
        {%endwith%}
    {% endif  %}
    {% with background_color="rgba(163,206,241,0.3)",
            border_color="#a3cef1",
            hx_post = url("core:rest", kwargs={"m" : "project.Stream" }),
            hx_vals ={"project" :  project.id },
            attr = "streams", 
            title = "Streams" %}
        {% include "alpine_fragments/create_fk.html"  %}
    {%endwith%}
    {% with background_color=models["project.Contact"].trigger_color,
            border_color=models["project.Contact"].hex_trigger_color,
            attr = "point_of_contact", 
            title = "Contact" %}
        {% include "alpine_fragments/edit_fk.html"  %}
    {%endwith%}
    {% with background_color=models["project.Tag"].trigger_color,
            border_color=models["project.Tag"].hex_trigger_color,
            attr = "tags", 
            title = "Tag" %}
        {% include "alpine_fragments/edit_fk.html"  %}
    {%endwith%}
    {% with background_color=models["project.Team"].trigger_color,
            border_color=models["project.Team"].hex_trigger_color,
            attr = "teams", 
            title = "Teams" %}
        {% include "alpine_fragments/edit_fk.html" %}
    {%endwith%}
</div>
#}


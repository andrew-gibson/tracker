{% if  standalone %} {% extends "base.html" %} {% endif %}

{% block nav %}
    {%with navbar=[ "shared/main-link.html"],navdropdown=[ "shared/metadata-link.html","project/project-navdropdown.html"]%}
        {%include "navbar.html"%}
    {%endwith%}
{%endblock%}

{% block content %}{%with project=inst  %}
<div id="main-content" >
    <div id="project{{project.id}}" class="card task p-0">
        <div class="card-header fs-6 p-0 justify-content-between d-flex align-items-center">
        </div>
        <div class="card-body pt-1 pb-0">
        </div>
        <div class="row align-items-center card-footer text-body-secondary fs-6 p-2">
            <div class=" col-4" id="new-stream">

            </div>
            <div class="col-8">
                {%with params=add_encode_parameter("f",{"ac_filters" :  { "stream" : { "project_id" :inst.id }},
                                                                   "attach_to": {"attr" : "project", "pk" : inst.id},
                                                                   "exclude" :  ["project"]}),
                       _url =  url("core:create_from_parsed", kwargs={"attr" :"name", "m" : "project.Task"}) %}
                    <p style="font-size: 0.8em" class="text-secondary mb-0">
                        {{models["project.Task"].describe_links()}}
                    </p>
                    <div hx-on::after-request="event.detail.requestConfig.verb == 'post' ? window.reset_ui('reloadTasks') : false">
                        <div hx-trigger="load"
                             hx-swap="outerHTML"
                             hx-get="{{_url}}?{{params}}">
                        </div>
                    </div>
                {%endwith%}
            </div>
        </div>
    </div>

    {%with params=add_encode_parameter("f",{"filters" :  { "project" : project.id }}),
               _url =  url("core:rest", kwargs={ "m" : "project.Stream"})    %}
        <div hx-trigger="load, reloadTasks from:document" 
             hx-get="{{_url}}?{{params}}">
        </div>
    {%endwith%}
</div>

<script type="module">
    import { make_right_dropdown } from "d3-ui";
    import {project_summary} from "{{ static('task_summary.js') }}";
    const project = {{dumps(inst)|safe}};
    project_summary({...project} );
</script>
{% endwith  %}
{%endblock%}

{% if  standalone %} {% extends "base.html" %} {% endif %}

{% block header_menu %}
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="#">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" 
                hx-replace-url="true"
                hx-swap="outerHTML"
                hx-target = "#main-content"
                hx-get="{{url('project:main')}}"> Back
              </a>
        </li>
        <li class="nav-item dropdown">
           <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                Settings ⚙️
           </a>
           <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="#">Delete</a></li>
              <li><a class="dropdown-item" href="#" id="settings-completed"></a></li>
          </ul>
        </li>
      </ul>
    </div>
{% endblock %}

{% block content %}{%with project=inst  %}
<div id="main-content" >
    <div class="row">
         {% include "project/project_summary.html"  %}

        <div class="col-8">

        {%with params=add_encode_parameter("f",{"ac_filters" :  { "stream" : { "project_id" :inst.id }},
                                                           "attach_to": {"attr" : "project", "pk" : inst.id},
                                                           "exclude" :  ["project"]}),
               _url =  url("core:create_from_parsed", kwargs={"attr" :"name", "m" : "project.Task"}) %}
            <p style="font-size: 0.8em" class="text-secondary mb-0">
                {{models["project.Task"].describe_links()}}
            </p>
            <div hx-on::after-request="event.detail.requestConfig.verb == 'post' ? window.reset_ui('reloadTasks') : false">
                <div hx-trigger="load"
                     hx-swap="outerHTML"
                     hx-get="{{_url}}?{{params}}">
                </div>
            </div>
        </div>
        {%endwith%}

    <div class="row">
    {%with params=add_encode_parameter("f",{"filters" :  { "project" : project.id }}),
               _url =  url("core:rest", kwargs={ "m" : "project.Stream"})    %}
        <div hx-trigger="load, reloadTasks from:document" 
             hx-get="{{_url}}?{{params}}">
        </div>
    {%endwith%}
    </div>

</div>


<script type="module">
import { make_right_dropdown } from "d3-ui";
import {project_summary} from "{{ static('task_summary.js') }}";
const project = {{dumps(inst)|safe}};
project_summary({...project} );
</script>
{% endwith  %}
{%endblock%}

{#
 expects to be passed in:
   attr: the model attribute linking to the lookup table
   model: the model representing the lookup table 
          has to: 
          * be a lookup table with an attribute called name
          * inherit from AutoCompleteREST
   title: the title to display to the user

#}

<div x-init="register(project,'{{attr}}')" class="mb-1">  
    {#  display mode #}
    <div  x-show="!project.adding.{{attr}}" >
        <div style='overflow-x: scroll, max-width: 100%;font-size: 0.8em'
             class="justify-content-between d-flex align-items-center">
                <button type="button" class="btn btn-link mb-1" 
                        style="font-size: 0.8em;"
                        @click="edit_value(project, '{{attr}}') ">  {# move into edit mode #}
                 {{title}}:
                </button>

            <ul class="list-group list-group-horizontal d-flex align-items-center" 
                style='overflow-x: scroll; max-width: 80%;'>
                <template x-for="item in (Array.isArray(project.{{attr}}) ? project.{{attr}} : project.{{attr}} ? [project.{{attr}} ] : [] )">   {# loop over all currently selected items to display them #} 
                    <li class="list-group-item d-flex p-1 me-1 bg-opacity-10 border-1 w-100 fw-bold"  
                        style="background-color: {{model.trigger_color}};
                               border-color:{{model.hex_trigger_color}};">
                        <span x-html="item.repr"></span>
                    </li>
                </template>
            </ul>
        </div>
    </div>

    {# edit mode #}
    <form x-show="project.adding.{{attr}}"
          style="width: 100%;"
          class="border p-2"
          method="post"
          @keyup.escape="cancel_edit_value(project, '{{attr}}')"   {# cancel out if ESC pressed #}>

        <div class="input-group input-group-sm d-flex align-items-center ">
          <span class="input-group-text"
                 :id="'{{attr}}_input'+ project.id+'-label'">
                 {{title}}
          </span>
          <input type="text" 
                 class="form-control" 
                 aria-label="" 
                 :aria-describedby="'{{attr}}_input'+ project.id+'-label'"
                 autocomplete="off" 
                 name="name"
                 :id="'{{attr}}_input'+ project.id"
                 @keyup.debounce="search_attr(project, '{{attr}}', $el)" {# debounce for better user UX, otherwise on every keyup search the database #}
                 @keyup.enter.prevent="()=>{}">  {# capture and ignore user pressing ENTER, this is just a filter input #}
          <button type="button" 
                  class="btn-close ms-2  p-2" 
                  style="opacity: 0.3;"
                  aria-label="Close" 
                  @click="cancel_edit_value(project, '{{attr}}')">  {# cancel out if button pressed #}
          </button>
        </div>
        <div x-show="search_results.{{attr}}.results.length" 
             style='overflow-x: scroll; max-width: 100%;padding-bottom: 10px;'>
            <ul class="list-group list-group-horizontal pt-2 " 
                style="font-size: 0.8em;">
            <template x-for="result in search_results.{{attr}}.results">
                <li class="list-group-item d-flex p-1 me-1 border-0" >
                    <span :style="result.selected ? 'border: 1px solid {{model.hex_trigger_color}};' : ''" > 
                    <button class="btn p-1"
                             style="background-color: {{model.trigger_color}};font-size:0.8rem;" 
                             @click.prevent="toggle_attr(project, '{{attr}}', result )">
                        <span x-html="result.repr"></span>
                        <span class="badge bg-success ms-1" x-show="result.new"> New</span> 
                    </button>
                    <span>
                </li>
            </template>
            </ul>
        </div>
    </form>
</div>

